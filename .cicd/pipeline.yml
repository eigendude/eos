env:
  BUILD_TIMEOUT: 120
  TEST_TIMEOUT: 60
  TIMEOUT: 120
  VERBOSE: true

steps:

  # - label: ":webhook: Trigger Travis CI Build"
  #   command:
  #     - "./.cicd/travis/travis-trigger.sh"
  #   agents:
  #     queue: "automation-eos-builder-fleet"

  # - trigger: "eosio-base-images-beta"
  #   label: ":docker: Ensure base images exist"
  #   build:
  #     commit: "${BUILDKITE_COMMIT}"
  #     branch: "${BUILDKITE_BRANCH}"

  - wait

  - label: ":aws: [Amazon] 2 Build"
    agents:
      queue: "automation-eos-builder-fleet"
    plugins:
      - docker#v3.2.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-amazonlinux-2-18882a30e04e71ee7201ebb5993e8b5278d1edce"
          environment:
            - "ENABLE_PARALLEL_TESTS=true"
            - "ENABLE_SERIAL_TESTS=true"
            - "ENABLE_LR_TESTS=true"
            - "ENABLE_PACKAGE_BUILDER=true"
            - "ENABLE_SUBMODULE_REGRESSION_TEST=true"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_AMAZON_LINUX_2

  - label: ":centos: [CentOS] 7 Build"
    command:
      - ""
    agents:
      queue: "automation-eos-builder-fleet"
    plugins:
      - docker#v3.2.0:
          debug: $DEBUG
          image: "eosio/producer:eosio-centos-7-c1679b2d61caf2957b93f0ad8890bf548512607d"
          environment:
            - "ENABLE_PARALLEL_TESTS=true"
            - "ENABLE_SERIAL_TESTS=true"
            - "ENABLE_LR_TESTS=true"
            - "ENABLE_PACKAGE_BUILDER=true"
            - "ENABLE_SUBMODULE_REGRESSION_TEST=true"
    timeout: $BUILD_TIMEOUT
    skip: $SKIP_CENTOS_7

  # - label: ":ubuntu: [Ubuntu] 16.04 Build"
  #   agents:
  #     queue: "automation-eos-builder-fleet"
  #   plugins:
  #     - docker#v3.2.0:
  #         debug: $DEBUG
  #         image: "eosio/producer:eosio-ubuntu-16.04-4f430ef21e359ef2581c25255c99e5411adfaed9"
  #   timeout: $BUILD_TIMEOUT
  #   skip: $SKIP_UBUNTU_16

  # - label: ":ubuntu: [Ubuntu] 18.04 Build"
  #   agents:
  #     queue: "automation-eos-builder-fleet"
  #   plugins:
  #     - docker#v3.2.0:
  #         debug: $DEBUG
  #         image: "eosio/producer:eosio-ubuntu-18.04-14091ac0e5618b0ea5ce026cd75b648efbde4be7"
  #   timeout: $BUILD_TIMEOUT
  #   skip: $SKIP_UBUNTU_18

  # - label: ":darwin: [Darwin] 10.14 Build"
  #   command:
  #     - "brew install git graphviz libtool gmp llvm@4 pkgconfig python python@2 doxygen libusb openssl boost@1.70 cmake"
  #     - "git clone $BUILDKITE_REPO eos && cd eos && git checkout $BUILDKITE_COMMIT && git submodule update --init --recursive"
  #     - "cd eos && mkdir build && cd build && cmake .. && make -j$(getconf _NPROCESSORS_ONLN)"
  #     - "cd eos/build && ctest -j$(getconf _NPROCESSORS_ONLN) -LE _tests --output-on-failure -T Test"
  #   plugins:
  #     - chef/anka#v0.5.1:
  #         no-volume: true
  #         inherit-environment-vars: true
  #         vm-name: 10.14.4_6C_14G_40G
  #         vm-registry-tag: "clean::cicd::git-ssh::nas::brew"
  #         modify-cpu: 12
  #         modify-ram: 24
  #         always-pull: true
  #         debug: true
  #         wait-network: true
  #   agents:
  #     - "queue=mac-anka-large-node-fleet"
  #   timeout: $BUILD_TIMEOUT
  #   skip: $SKIP_MOJAVE